#!/bin/bash

# Builder directory
BUILDERDIR=~/Desktop/projector
source "$BUILDERDIR/global.sh"




# Check if current folder is a project folder
if [[ -d "${BASEDIR}/wp/wp-content" ]] && [[ -f "${BASEDIR}/database/dump/wordpress_data.sql" ]]; then


	# Extract the project name from BASEDIR
	SLUG="${BASEDIR%"${BASEDIR##*[!/]}"}"
	SLUG="${SLUG##*/}"
	#echo "Project name: $SLUG"


	# Project directory
	PROJECTDIR=$BASEDIR


fi # If current folder is a project folder




# Ask for the action, if not specified
ACTION=$1
if [[ -z $ACTION ]]; then


	read -ep "Write the action type (starter | clone | install | uninstall | start | stop | import | pull | push): " ACTION
	if [[ -z $ACTION ]]; then

		echo -e "${RED}No action entered.${RESET}"
		exit

	fi


fi


# If unknown answer
if [[ $ACTION != starter ]] && [[ $ACTION != clone ]] && [[ $ACTION != install ]] && [[ $ACTION != import ]] && [[ $ACTION != start ]] && [[ $ACTION != stop ]] && [[ $ACTION != uninstall ]] && [[ $ACTION != pull ]] && [[ $ACTION != push ]]; then

	echo -e "${RED}Wrong action.${RESET}"
	exit

fi




# If current folder is not a specific project folder
if [[ -z $SLUG ]] && [[ -z $PROJECTDIR ]]; then


	# Get project name from args
	if [[ ! -z $2 ]]; then

		SLUG=$2

	else


		# Ask for the project name
		read -ep "Project name (site-name): " SLUG
		while [[ -z $SLUG ]]; do
			read -ep "Project name (site-name): " SLUG
		done


	fi


	# Project directory
	PROJECTDIR="${BASEDIR}/${SLUG}"


fi




# Installation Check
INSTALLED="no"
if [[ -f "$PROJECTDIR/.env" ]]; then


	# Get data from .env file
	source "$PROJECTDIR/.env"


	if [[ $IP != "127.0.0.1" ]]; then

		INSTALLED="yes"

	fi # If already installed


fi # If has an .env file




##Â DO THE ACTION:
if [[ -f "$BUILDERDIR/actions/$ACTION" ]]; then

	source "$BUILDERDIR/actions/$ACTION"

fi