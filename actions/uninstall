#!/bin/bash




# Check if the folder not exists
if [[ ! -d "$PROJECTDIR" ]]; then

	echo -e "${RED}Project doesn't exist.${RESET}"
	exit

fi




read -ep "Are you sure you want to uninstall the '$SLUG' project? (yes | no): " confirm
if [[ $confirm != yes ]] && [[ $confirm != y ]]; then

	echo -e "${RED}Not confirmed.${RESET}"
	exit

fi




# Check if installed
if [[ $INSTALLED != "yes" ]]; then

	echo -e "${RED}Project is not installed. But still trying to remove...${RESET}"

fi




# Get environmental data
get_env_data




# Create and Update environment files
update_environment




## UNINSTALLATION:

# Save a DB backup first
db_backup




# Close the server
echo "Server is closing..."
docker_compose down -v --rmi local --remove-orphans




# Remove the host to the list
sudo bash "$BUILDERDIR/config/etc-hosts.sh" -remove $DOMAIN
#killall -HUP mDNSResponder




# Delete the DB files
rm -rf "$PROJECTDIR/database/mysql"
echo -e "MySQL files removed ... ${GREEN}done${RESET}"




# Remove WP core files
(
	cd "$PROJECTDIR/wp"
	find . -mindepth 1 -maxdepth 1 ! -name 'wp-content' -exec rm -rf '{}' \;
)
echo -e "WP core files removed ... ${GREEN}done${RESET}"




# Delete the .env file
rm -rf "$PROJECTDIR/.env"
echo -e ".env file removed from the project ... ${GREEN}done${RESET}"




# Optional: Remove the folder
if [[ $OPTION1 == --remove ]]; then


	echo -e "Project folder removing..."
	rm -rf "$PROJECTDIR"
	echo -e "Project folder removed ... ${GREEN}done${RESET}"


fi




echo -e "Uninstalling '$SLUG' project ... ${GREEN}done${RESET}"
